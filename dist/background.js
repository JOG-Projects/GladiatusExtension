(()=>{"use strict";var e={136:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{u(n.next(e))}catch(e){r(e)}}function l(e){try{u(n.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,l)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=o(219),r=o(67),a=o(437);chrome.runtime.onMessage.addListener((function(e,t,o){return n(this,void 0,void 0,(function*(){console.log(t.tab?"from a content script:"+t.tab.url:"from the extension"),console.log("request type: "+e.type),"config"===e.type&&chrome.tabs.create({url:"./view/config.html",selected:!0}),"start"===e.type&&(yield function(){return n(this,void 0,void 0,(function*(){yield function(){return n(this,void 0,void 0,(function*(){let e=yield new Promise((e=>{chrome.tabs.query({url:"https://*.gladiatus.gameforge.com/*"},(t=>e(t)))}));if(e.length>1)throw"More than one gladiatus tabs are open";let t=e[0];if(!t)throw"Cant find gladiatus tab";console.log(`"Found tab id: ${t.id}`),yield(0,r.setStorage)("tabId",t.id)}))}(),yield(0,i.initAlarms)()}))}()),"log"===e.type&&(e.log.level==a.TipoLog.info?console.log:console.error)(e.message),o()}))})),chrome.alarms.onAlarm.addListener(i.handleAlarm)},219:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{u(n.next(e))}catch(e){r(e)}}function l(e){try{u(n.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,l)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.initAlarms=t.handleAlarm=void 0;const i=o(67),r=o(609);function a(e){let t=(0,i.tomorrowMidnight)();console.log(`Finalizado runs de hoje, alarme programado para ${new Date(t)}`),(0,i.createAlarm)("atkRun",t,e)}t.handleAlarm=function(e){var t,o,l;return n(this,void 0,void 0,(function*(){if(console.log(`Disparado alarme: ${e.name}`),"atkRun"===e.name){yield(0,r.initAttackPlayers)();let e=null!==(t=yield(0,i.getFromStorage)("ultimaRunCompleta"))&&void 0!==t?t:Date.now(),n=null!==(o=yield(0,i.getFromStorage)("qtdAtks"))&&void 0!==o?o:0,u=null!==(l=yield(0,i.getFromStorage)("runCooldown"))&&void 0!==l?l:25;console.log(`qtdAtk: ${n}`),console.log(`ultimaRun: ${new Date(e)}`),console.log(`runCooldown: ${u}`),yield(0,i.setStorage)("ultimaRunCompleta",Date.now()),yield(0,i.setStorage)("qtdAtks",++n),new Date(e).getDate()==(new Date).getDate()&&5==n&&(yield a(u))}}))},t.initAlarms=function(){return n(this,void 0,void 0,(function*(){yield function(){var e,t,o;return n(this,void 0,void 0,(function*(){let n=null!==(e=yield(0,i.getFromStorage)("runCooldown"))&&void 0!==e?e:25,r=null!==(t=yield(0,i.getFromStorage)("ultimaRunCompleta"))&&void 0!==t?t:Date.now(),l=null!==(o=yield(0,i.getFromStorage)("qtdAtks"))&&void 0!==o?o:0;console.log(`qtdAtk: ${l}`),console.log(`ultimaRun: ${new Date(r)}`),console.log(`runCooldown: ${n}`),new Date(r).getDate()!=(new Date).getDate()||5!=l?(console.log(`Setting up alarm to ${new Date(r)}`),(0,i.createAlarm)("atkRun",r+1e3,n)):yield a(n)}))}()}))}},67:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{u(n.next(e))}catch(e){r(e)}}function l(e){try{u(n.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,l)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.logError=t.log=t.clickAndWait=t.getByXpath=t.tomorrowMidnight=t.createAlarm=t.timeout=t.setStorage=t.getFromStorage=t.execute=t.tryUntil=void 0;const i=o(437);function r(e){return new Promise((function(t){chrome.storage.sync.get(e,(o=>t(o[e])))}))}function a(e){return n(this,void 0,void 0,(function*(){yield new Promise((t=>setTimeout(t,e)))}))}function l(e){let t=document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!t)throw new Error(`Element ${t} wasn't found`);return t}function u(e,t){return n(this,void 0,void 0,(function*(){yield new Promise((function(e,t){chrome.runtime.sendMessage(u,e)}))}))}t.tryUntil=function e(t){return n(this,void 0,void 0,(function*(){try{yield t()}catch(o){yield a(200),yield e(t)}}))},t.execute=function(e){return n(this,void 0,void 0,(function*(){var t=yield r("tabId");yield new Promise((function(o,n){let i={tabId:t,file:e};chrome.tabs.executeScript(i,o)}))}))},t.getFromStorage=r,t.setStorage=function(e,t){return n(this,void 0,void 0,(function*(){yield new Promise((function(o){let n={};n[e]=t,chrome.storage.sync.set(n,o)}))}))},t.timeout=a,t.createAlarm=function(e,t,o){let n={periodInMinutes:o,when:t};chrome.alarms.create(e,n)},t.tomorrowMidnight=function(){let e=new Date;return e.setDate(e.getDate()+1),e.setHours(0,0,0,0),e.getTime()},t.getByXpath=l,t.clickAndWait=function(e,t){return n(this,void 0,void 0,(function*(){let o=l(e);null==o||o.click(),yield a(null!=t?t:0)}))},t.log=u,t.logError=function(e){return n(this,void 0,void 0,(function*(){yield u(i.TipoLog.erro)}))}},609:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function a(e){try{u(n.next(e))}catch(e){r(e)}}function l(e){try{u(n.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,l)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.initAttackPlayers=void 0;const i=o(67);function r(e){return n(this,void 0,void 0,(function*(){console.log("Abrindo arena"),yield(0,i.execute)("src/injected/objectives/arena/abrirArena.js"),yield(0,i.setStorage)("currentAtkPlayer",e),console.log(`Atacando jogador: ${e}`),yield(0,i.execute)("src/injected/objectives/arena/atacarPlayer.js")}))}function a(){return n(this,void 0,void 0,(function*(){yield(0,i.execute)("src/injected/objectives/menusLaterais/getAtkCooldown.js");let e=yield(0,i.getFromStorage)("atkCooldown");console.log(`Esperando cooldown: ${e.minutos}:${e.segundos}`),yield(0,i.timeout)(1e3*(60*e.minutos+e.segundos))}))}function l(){return n(this,void 0,void 0,(function*(){yield(0,i.execute)("src/injected/objectives/menusLaterais/getHP.js"),yield(0,i.getFromStorage)("percentHP")}))}t.initAttackPlayers=function(){return n(this,void 0,void 0,(function*(){let e=yield function(){return n(this,void 0,void 0,(function*(){let e=yield(0,i.getFromStorage)("atkListPlayers");if(!e||0==e.length)throw"Sem players configurados para atacar";return e.split("\n")}))}();console.log(`iniciando ataque aos players ${e}`),yield function(e){return n(this,void 0,void 0,(function*(){for(let t of e)yield r(t),yield l(),yield a()}))}(e)}))}},437:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.TipoLog=void 0,(o=t.TipoLog||(t.TipoLog={}))[o.info=0]="info",o[o.erro=1]="erro"}},t={};!function o(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,o),r.exports}(136)})();